---
title: "Problema 2 - Checkpoint 1"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
library(plotly)
library(viridis)
library(ggplot2)

theme_set(theme_bw())
```


```{r}
dados = read_csv(here("data/series_from_imdb.csv"), 
                    progress = FALSE,
                    col_types = cols(.default = col_double(), 
                                     series_name = col_character(), 
                                     episode = col_character(), 
                                     url = col_character(),
                                     season = col_character()))
```

#1. A má avaliação de uma temporada implica no cancelamento da série?
### Para responder essa pergunta irei selecionar as 4 primeiras temporadas das 6 séries que foram canceladas para tomar como dado base, e analisar o desenvolvimento das suas avaliações médias por temporada.

```{r}
dados$season <- as.integer(dados$season)
sumarios = dados %>% 
      filter(series_name %in% c("2 Broke Girls","Sense8", "The Killing", "House of Cards","Heroes","Under The Dome"))%>%
    filter(season<=4) %>%
    group_by(series_name,season) %>% 
    summarise(
        season_rating = round(mean(user_rating),2))

p <- ggplot(data = sumarios, aes(x = season,y=season_rating, fill = series_name)) +
            geom_bar(stat = "identity",position = "dodge")
ggplotly(p)

``` 
Usando um gráfico de barras interativo, o qual representa a avalição média por temporada de cada série cancelada. É visualizado que não existe um padrão de má avaliação como motivo de cancelamento da série. Séries como Under The Dome, 2 Broke Girls, e Heroes, tiveram um decaimento na sua avalição média, por outro lado, séries como The Killing, Sense8 e House of Cards tiveram boas e crescentes avaliações, mesmo assim foram canceladas. Logo, apenas a má avaliação de uma temporada não implica no cancelamento da série, existem outros fatores que podem infligir no cancelamento da série, como alto orçamento(No caso de sense8), polêmica com o protagonista(House of Cards), ou falta de audiência no caso de The Killing.

#2. Observando os dados da questão 1, é possível afirmar que existiu um constante decaímento na audiência nas séries que tiveram constante uma baixa na avaliação média? 
### Para responder essa pergunta irei analisar a quantidade de votos das séries que tiveram uma queda na avaliação média com o decorrer das temporadas: Under The Dome, Heroes.
```{r}
sumarios = dados %>% 
      filter(series_name %in% c("Heroes","Under The Dome"))%>%
    group_by(series_name,season) %>% 
    summarise(
        season_rating = round(mean(user_rating),2),
        season_votes = round(mean(user_votes),2))
    sumarios$season <- as.integer(sumarios$season)
heroes = sumarios%>%
    filter(series_name %in% c("Heroes"))
p1 <- plot_ly(sumarios, x = ~heroes$season, y = ~heroes$season_rating, 
        mode = "markers", color = heroes$season_votes, size = heroes$season_votes, marker=list(sizeref=0.1)) %>%
  layout(
    title = 'Heroes',
    xaxis = list(
      title = 'Temporada',
      range = c(0,5)
    ),
    yaxis = list(
      title = 'Avaliação média'
    )%>% colorbar(title = "Quantidade de votos")
  )
under = sumarios%>%
    filter(series_name %in% c("Under The Dome"))
p2 <- plot_ly(sumarios, x = ~under$season, y = ~under$season_rating, 
        mode = "markers", color = under$season_votes, size = under$season_votes, marker=list(sizeref=0.1)) %>%
  layout(
    title = 'Under the Dome',
    xaxis = list(
      title = 'Temporada',
      range = c(0,5)
    ),
    yaxis = list(
      title = 'Avaliação média'
    )
  )%>% colorbar(title = "Quantidade de votos")

ggplotly(p1)
ggplotly(p2)

```
Utilizando 2 gráficos interativos, é possivel perceber que enquanto a avaliação média sofre um decaimento, a quantidade de votos cai da mesma forma, existindo assim uma associação entre avaliação média, quantidade de votos e o cancelamento dessas 2 séries.